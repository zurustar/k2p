# Manual Testing Guide

## 準備

### 1. Kindleアプリのセットアップ
1. Mac App Storeから「Kindle」をインストール
2. Amazonアカウントでサインイン
3. テスト用の本をダウンロード（推奨: 3-5ページの短い本）

### 2. ビルド確認
```bash
cd /Users/oumi/Documents/GitHub/k2p
make build
./build/k2p --version
```

## テスト方法

### 簡単な方法: テストスクリプトを使用

```bash
./test_manual.sh
```

スクリプトが対話的にガイドしてくれます。

### 手動でテストする場合

#### 事前メモ: ページめくりの挙動
- k2pは起動直後にKindleを一度だけアクティブ化し、その後はウィンドウを切り替えずにページめくり→スクリーンショットを繰り返します。
- デフォルトのページ遅延は`500ms`です。ページ切り替え後の描画が遅い場合は`--page-delay 750ms`などで余裕を持たせてください。
- ページめくり方向は右矢印を基準に自動判定します。左めくりの本では`--page-turn-key left`を明示してください。

#### Test 1: 基本的な変換

1. **準備**
   - Kindleアプリで本を開く
   - 最初のページに移動

2. **実行**
   ```bash
   ./build/k2p --verbose -o ~/Desktop/test1
   ```

3. **操作**
   - プロンプトが表示されたら**Enterキーを押す**
   - カウントダウン中に**Kindleウィンドウをクリック**して前面に
   - **何もせず待つ**（触らない！）

4. **確認**
   ```bash
   open ~/Desktop/test1/kindle_book_*.pdf
   ```
   - すべてのページが含まれているか
   - 画質は十分か
   - 黒/白の縁が削除されているか

#### Test 2: トリミング比較

1. **トリミングなしで変換**
   ```bash
   # Kindleで本を最初のページに戻す
   ./build/k2p -o ~/Desktop/test2_no_trim
   ```

2. **トリミングありで変換**
   ```bash
   # Kindleで本を最初のページに戻す
   ./build/k2p --trim-borders -o ~/Desktop/test2_with_trim
   ```

3. **比較**
   - 両方のPDFを開いて並べて比較
   - トリミングの効果を確認

#### Test 3: エラーケース

1. **本を開いていない状態**
   ```bash
   # Kindleアプリを閉じる
   ./build/k2p
   # → "Kindle app is not installed" または "No book is currently open" エラー
   ```

2. **中断テスト**
   ```bash
   # 変換開始後、数ページでCtrl+C
   # → 一時ファイルがクリーンアップされることを確認
   ls /tmp/k2p-* 2>/dev/null  # 何も表示されないはず
   ```

## チェックリスト

### 動作確認
- [ ] Kindleアプリが検出される
- [ ] 本が開いているか検出される
- [ ] フォアグラウンドチェックが動作する
- [ ] 自動的にページがめくられる
- [ ] スクリーンショットが撮影される
- [ ] 進捗が表示される
- [ ] PDFが生成される

### トリミング確認
- [ ] 黒い縁が削除される
- [ ] 白い縁が削除される
- [ ] コンテンツが削除されない
- [ ] トリミング失敗時は元の画像を使用

### エラー処理確認
- [ ] 適切なエラーメッセージが表示される
- [ ] 一時ファイルがクリーンアップされる
- [ ] Ctrl+Cで正常に中断できる

### 出力品質確認
- [ ] すべてのページが含まれている
- [ ] ページの順序が正しい
- [ ] 画質が十分
- [ ] ファイルサイズが妥当

## トラブルシューティング

### スクリーンショットが撮れない
**症状**: エラーメッセージ "failed to capture screenshot"

**解決方法**:
1. システム環境設定 > セキュリティとプライバシー > プライバシー
2. 「画面収録」を選択
3. ターミナル（またはk2pを実行しているアプリ）にチェックを入れる
4. ターミナルを再起動

### ページめくりが動かない
**症状**: 同じページが繰り返しキャプチャされる

**解決方法**:
1. Kindleアプリが本当に前面にあるか確認
2. `--startup-delay 10s` で準備時間を長くする
3. `--page-turn-key left` を指定して左右判定を強制する
4. `--page-delay 750ms` などでページ描画の待ち時間を延ばす
5. Kindleアプリを再起動

### トリミングがうまく動かない
**症状**: 縁が削除されない、またはコンテンツが削除される

**確認方法**:
1. `--verbose` で詳細ログを確認
2. `--trim-borders` を付けずに実行して元の画像を確認
3. 元の画像に本当に均一な縁があるか確認

## 結果の報告

テスト結果を以下の形式で報告してください：

```
## テスト環境
- macOS バージョン: 
- Kindleアプリ バージョン: 
- テストした本: 

## テスト結果
- [ ] Test 1: 基本変換 - 成功/失敗
- [ ] Test 2: トリミング比較 - 成功/失敗
- [ ] Test 3: エラーケース - 成功/失敗

## 問題点
（あれば記載）

## スクリーンショット
（必要に応じて添付）
```
