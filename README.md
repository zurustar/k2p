# k2p

Kindle アプリを macOS 上で自動操作し、ページごとのスクリーンキャプチャを撮る Go 製のツールです。オリジナルの Python/AppleScript ツールと同様に、Kindle アプリを前面に出しながら所定のページ数だけ送りつつ画像を保存します。

## 使い方

1. Kindle アプリでキャプチャしたい書籍を開き、最初に撮りたいページを表示しておきます。
2. 端末のスクリーンショット権限（システム設定 > プライバシーとセキュリティ > 画面収録）でターミナル/シェルに許可を付与してください。
3. 下記コマンドを実行します。

```bash
# 10 ページ分を撮影し、screens ディレクトリに kindle-0001.png ... を保存
PAGES=10

go run . -pages $PAGES

# Kindle を前面に出したくない場合は -activate=false を指定
# ページ送りとキャプチャの間隔を変更したい場合は -delay を調整（デフォルト 1.2s）
go run . -pages $PAGES -delay 800ms -output ./shots -prefix sample -activate=false
```

## オプション

- `-pages`      : キャプチャするページ数（必須）。
- `-output`     : 出力ディレクトリ（デフォルト: `screens`）。
- `-prefix`     : 生成するファイル名プレフィックス（デフォルト: `kindle`）。
- `-delay`      : ページ送り後に待機する時間。ページが描画されるまでの余裕として利用します（デフォルト: `1.2s`）。
- `-activate`   : 開始前に Kindle アプリを前面に出すかどうか（デフォルト: `true`）。
- `-prep-delay` : アクティベーション後、最初のキャプチャまでに待つ時間（デフォルト: `2s`）。

## 挙動

- macOS 専用です。`osascript` と `screencapture` を呼び出すため、他 OS ではエラーになります。
- Kindle アプリに対して `System Events` を用いて右矢印キー（`key code 124`）を送信し、ページを進めます。
- 各ページ表示後に指定した待ち時間を設け、`screencapture -x` でフルスクリーンを PNG として保存します。
- 事前に Kindle アプリを開き、表示したいページを出しておくことで意図通りのスクリーンキャプチャを取得できます。

## よくあるトラブル

- **アクセシビリティ/画面収録の許可不足**: ページ送りやスクリーンショットが失敗する場合、ターミナル（または使用中のシェルアプリ）にアクセシビリティと画面収録の許可があることを確認してください。
- **ページが進まない**: Kindle アプリが最前面でないと `System Events` のキー送信が届きません。`-activate=true`（デフォルト）を使うか、手動で前面に出してください。
- **余白やツールバーが写る**: Kindle アプリをフルスクリーンにしておくと不要な UI を避けやすくなります。
